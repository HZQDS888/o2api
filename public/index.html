<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小黑邮箱管理系统 QQ:113575320</title>
    <style>
        /* 基础样式 - 暗色主题 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            background-color: #121212; /* 页面背景黑 */
            overflow-x: hidden;
        }

        /* 侧边栏样式 - 暗色 */
        .sidebar {
            width: 250px;
            background-color: #1e1e1e; /* 侧边栏黑灰 */
            color: #e0e0e0; /* 文字浅灰 */
            height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease;
            position: fixed;
            z-index: 100;
        }

        .sidebar h2 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 24px;
            color: #3498db; /* 蓝色强调 */
        }

        .sidebar ul {
            list-style-type: none;
            padding: 0;
        }

        .sidebar ul li {
            margin: 10px 0;
        }

        .sidebar ul li a {
            color: #e0e0e0;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .sidebar ul li a:hover {
            background-color: #3498db;
            color: #ffffff;
            transform: translateX(5px);
        }

        .sidebar ul li a.active {
            background-color: #3498db;
            color: #ffffff;
            font-weight: bold;
        }

        .sidebar ul li a i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* 购买按钮特殊样式（蓝色） */
        .sidebar ul li .buy-link {
            background-color: #3498db; /* 蓝色主色 */
            color: #ffffff;
            font-weight: bold;
        }

        .sidebar ul li .buy-link:hover {
            background-color: #2980b9; /* 蓝色hover色 */
            transform: translateX(5px);
        }

        /* 内容区域样式 - 暗色 */
        .content {
            flex-grow: 1;
            padding: 30px;
            background-color: #121212;
            margin-left: 250px;
            transition: margin-left 0.3s ease;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* 移动端菜单按钮 */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 101;
            background-color: #3498db;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        /* 邮件列表搜索区域 */
        .mail-search-section {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .mail-search-section input[type="text"] {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 4px;
            width: 300px;
            margin-right: 10px;
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .mail-search-section button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .mail-search-section button:hover {
            background-color: #2980b9;
        }

        .mail-search-section button:nth-child(3) {
            background-color: #4a4a4a;
            margin-left: 10px;
        }

        .mail-search-section button:nth-child(3):hover {
            background-color: #5f5f5f;
        }

        /* 内容区域隐藏/显示 */
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .content-section.active {
            display: block;
        }

        /* 仪表盘统计卡片样式 - 暗色 */
        .dashboard-cards {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .dashboard-card {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            flex: 1;
            min-width: 200px;
            text-align: center;
            border: 1px solid #333;
        }

        .dashboard-card h3 {
            margin: 0;
            font-size: 18px;
            color: #e0e0e0;
        }

        .dashboard-card p {
            margin: 10px 0 0;
            font-size: 24px;
            color: #3498db;
            font-weight: bold;
        }

        /* 上传区域样式 - 暗色 */
        .upload-section {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            border: 1px solid #333;
        }

        .upload-section .upload-box {
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .upload-section .upload-box.dragover {
            background-color: #2d3436;
            border-color: #2980b9;
        }

        .upload-section .upload-box i {
            font-size: 24px;
            color: #3498db;
            margin-bottom: 10px;
        }

        .upload-section .upload-box p {
            margin: 0;
            color: #999999;
        }

        .upload-section .upload-box .file-info {
            margin-top: 10px;
            font-size: 14px;
            color: #3498db;
        }

        .upload-section .upload-box input[type="file"] {
            display: none;
        }

        .upload-section .delimiter-input {
            margin-top: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .upload-section .delimiter-input input[type="text"],
        .upload-section .delimiter-input input[type="password"] {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 4px;
            width: 200px;
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .upload-section .delimiter-input button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .upload-section .delimiter-input button:hover {
            background-color: #2980b9;
        }

        /* 搜索区域样式 - 暗色 */
        .search-section {
            margin: 20px 0;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .search-section input[type="text"] {
            padding: 8px;
            border: 1px solid #444;
            border-radius: 4px;
            width: 300px;
            background-color: #2d2d2d;
            color: #e0e0e0;
        }

        .search-section button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-section button:hover {
            background-color: #2980b9;
        }

        .search-section button:nth-child(3) {
            background-color: #4a4a4a;
        }

        .search-section button:nth-child(3):hover {
            background-color: #5f5f5f;
        }

        /* 表格容器 - 支持横向滚动 */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
        }

        /* 表格样式 - 暗色 */
        .email-table,
        .mail-table {
            width: 100%;
            min-width: 768px; /* 确保小屏幕可滚动 */
            border-collapse: collapse;
            background-color: #1e1e1e;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }

        .email-table th,
        .email-table td,
        .mail-table th,
        .mail-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #333;
            font-size: 14px;
            color: #e0e0e0;
        }

        .email-table th,
        .mail-table th {
            background-color: #2d2d2d;
            color: #ffffff;
            font-weight: bold;
        }

        .email-table tr:hover,
        .mail-table tr:hover {
            background-color: #2d3436;
        }

        .email-table td,
        .mail-table td {
            word-wrap: break-word;
        }

        .email-table .refresh-token {
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .email-table .actions,
        .mail-table .actions {
            white-space: nowrap;
            display: flex;
            gap: 5px;
        }

        .email-table .actions button,
        .mail-table .actions button {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.3s ease;
        }

        .email-table .actions button.view,
        .mail-table .actions button.view {
            background-color: #3498db;
            color: #ffffff;
        }

        .email-table .actions button.edit {
            background-color: #27ae60;
            color: #ffffff;
        }

        .email-table .actions button.edit:hover {
            background-color: #219653;
        }

        .email-table .actions button.delete,
        .mail-table .actions button.delete {
            background-color: #e74c3c;
            color: #ffffff;
        }

        .email-table .actions button:hover,
        .mail-table .actions button:hover {
            opacity: 0.9;
        }

        /* 密码显示/隐藏按钮 */
        .password-toggle {
            background: transparent;
            border: none;
            color: #3498db;
            cursor: pointer;
            font-size: 12px;
            padding: 0 5px;
        }

        /* 分页样式 - 暗色 */
        .pagination {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .pagination button {
            padding: 6px 12px;
            margin: 0 5px;
            border: 1px solid #3498db;
            border-radius: 4px;
            background-color: #1e1e1e;
            color: #3498db;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .pagination button.active {
            background-color: #3498db;
            color: #ffffff;
        }

        .pagination button:hover {
            background-color: #3498db;
            color: #ffffff;
        }

        /* 无数据提示 - 暗色 */
        .no-data {
            text-align: center;
            padding: 20px;
            color: #999999;
            font-size: 16px;
        }

        /* 模态框样式 - 暗色 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 1px solid #333;
        }

        .modal-content h3 {
            margin-top: 0;
            color: #e0e0e0;
        }

        .modal-content p {
            color: #999999;
        }

        .modal-content button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            margin: 0 5px;
        }

        .modal-content button.cancel {
            background-color: #4a4a4a;
        }

        .modal-content button:hover {
            background-color: #2980b9;
        }

        .modal-content button.cancel:hover {
            background-color: #5f5f5f;
        }

        /* 编辑模态框特殊样式 */
        .edit-modal-content {
            max-width: 500px;
        }

        .edit-modal-content .form-group {
            margin: 15px 0;
            text-align: left;
        }

        .edit-modal-content label {
            display: block;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        .edit-modal-content input {
            width: 100%;
            padding: 8px;
            border: 1px solid #444;
            border-radius: 4px;
            background-color: #2d2d2d;
            color: #e0e0e0;
            box-sizing: border-box;
        }

        /* 邮件详情模态框样式 - 暗色 */
        .mail-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .mail-modal-content {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid #333;
        }

        .mail-modal-content h3 {
            margin-top: 0;
            color: #e0e0e0;
        }

        .mail-modal-content p {
            color: #999999;
            word-wrap: break-word;
        }

        .mail-modal-content button {
            padding: 8px 16px;
            background-color: #3498db;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            position: sticky;
            bottom: 0;
            width: 100%;
            margin-top: 20px;
        }

        .mail-modal-content button:hover {
            background-color: #2980b9;
        }

        /* Loading 样式 */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            border: 4px solid #333;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* 淡入动画 */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .email-handel {
            display: flex;
            align-items: center;
        }

        .email-handel .delimiter-input {
            justify-content: left;
            margin-top: 0px;
        }

        .delete-btn {
            background-color: #e74c3c !important;
            margin-left: 10px !important;
        }

        .delete-btn:hover {
            background-color: #e74c3c !important;
            opacity: 0.9 !important;
        }

        /* 删除全部按钮样式 */
        .delete-all-btn {
            background-color: #c0392b !important;
            margin-left: 10px !important;
        }

        .delete-all-btn:hover {
            background-color: #a5281b !important;
            opacity: 0.9 !important;
        }

        .pagination-section {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 20px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .pagination-section .pagination {
            margin-top: 0px;
        }

        #items-per-page {
            padding: 6px 15px;
            border: 1px solid #444;
            border-radius: 5px;
            background-color: #2d2d2d;
            color: #e0e0e0;
            font-size: 16px;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="%23e0e0e0" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        /* 导出按钮样式 */
        .export-btn {
            background-color: #f39c12 !important;
            margin-left: 10px !important;
        }

        .export-btn:hover {
            background-color: #e67e22 !important;
            opacity: 0.9 !important;
        }

        /* 移动端适配 - 屏幕宽度小于768px */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .content {
                margin-left: 0;
                padding: 20px 15px;
                padding-top: 60px; /* 给菜单按钮留出空间 */
            }

            .menu-toggle {
                display: block;
            }

            .dashboard-cards {
                flex-direction: column;
            }

            .dashboard-card {
                width: 100%;
                min-width: auto;
            }

            .upload-section .delimiter-input {
                flex-direction: column;
                align-items: stretch;
            }

            .upload-section .delimiter-input input[type="text"],
            .upload-section .delimiter-input input[type="password"] {
                width: 100%;
                margin-right: 0;
            }

            .search-section, .mail-search-section {
                flex-direction: column;
                align-items: stretch;
            }

            .search-section input[type="text"],
            .mail-search-section input[type="text"] {
                width: 100%;
                margin-right: 0;
            }

            .search-section button,
            .mail-search-section button {
                width: 100%;
                margin-left: 0;
            }

            .pagination-section {
                flex-direction: column;
                gap: 10px;
            }

            .email-table .actions,
            .mail-table .actions {
                flex-wrap: wrap;
            }

            .email-table .actions button,
            .mail-table .actions button {
                flex: 1;
                margin-bottom: 5px;
                margin-right: 0;
            }
        }
    </style>
    <!-- 引入Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- 引入CryptoJS用于密码加密 -->
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
</head>

<body>
    <!-- 移动端菜单按钮 -->
    <button class="menu-toggle" id="menu-toggle">
        <i class="fas fa-bars"></i>
    </button>

    <!-- Loading 效果 -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="sidebar" id="sidebar">
        <h2>小黑邮箱管理系统 QQ:113575320</h2>
        <ul>
            <li><a href="#" data-target="dashboard" class="active"><i class="fas fa-tachometer-alt"></i>仪表盘</a></li>
            <li><a href="#" data-target="emails"><i class="fas fa-envelope"></i>邮箱管理</a></li>
            <!-- 购买按钮及新增的两个蓝色按钮 -->
            <li><a href="https://68n.cn/8to6G" target="_blank" class="buy-link"><i class="fas fa-shopping-cart"></i>购买长效微软邮箱</a></li>
            <li><a href="https://link3.cc/hzqds888" target="_blank" class="buy-link"><i class="fas fa-th-large"></i>更多软件工具</a></li>
            <li><a href="https://www.qianxun1688.com/rights-shop/1CDFE3FC" target="_blank" class="buy-link"><i class="fas fa-ticket-alt"></i>全网会员5折优惠网</a></li>
        </ul>
    </div>

    <div class="content">
        <!-- 仪表盘内容（账号数量滑动显示） -->
        <div id="dashboard" class="content-section active">
            <h1>邮箱总数</h1>
            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>账号数量</h3>
                    <p id="account-count">0</p>
                </div>
            </div>
        </div>

        <!-- 邮箱管理内容（含删除全部、导出按钮） -->
        <div id="emails" class="content-section">
            <h1>邮箱管理</h1>
            <div class="upload-section">
                <div class="upload-box" id="upload-box">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>点击或拖拽文件到此处上传</p>
                    <div class="file-info" id="file-info"></div>
                    <input type="file" id="file-input" accept=".txt">
                </div>
                <div class="delimiter-input">
                    <input type="password" id="password" placeholder="输入验证密码 请联系小黑" oninput="setPassword()">
                    <input type="text" id="delimiter" placeholder="输入分隔符（如 ----）">
                    <button onclick="importEmails()">导入邮箱</button>
                    <button class="export-btn" onclick="exportData()">导出备份</button>
                    <button class="delete-btn" onclick="batchDelete()">批量删除</button>
                    <button class="delete-all-btn" onclick="deleteAllEmails()">删除全部邮箱</button>
                </div>
            </div>

            <!-- 新增搜索区域 -->
            <div class="search-section">
                <input type="text" id="email-search" placeholder="输入邮箱关键词搜索...">
                <button onclick="searchEmails()">搜索</button>
                <button onclick="clearSearch()">清空</button>
            </div>

            <div class="table-container">
                <table class="email-table" id="email-table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all"></th>
                            <th>Email</th>
                            <th>Password <button class="password-toggle" onclick="toggleAllPasswords()"><i class="fas fa-eye"></i></button></th>
                            <th>Client ID</th>
                            <th>Refresh Token</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 数据将动态添加到这里 -->
                    </tbody>
                </table>
            </div>
            <div class="no-data" id="no-data">暂无数据</div>
            <div class="pagination-section">
                <div class="pagination" id="pagination">
                    <button onclick="changePage(1)">1</button>
                </div>
                <select id="items-per-page" onchange="changeItemsPerPage(this.value)">
                    <option value="5">5 条/页</option>
                    <option value="10">10 条/页</option>
                    <option value="20">20 条/页</option>
                    <option value="50">50 条/页</option>
                    <option value="100">100 条/页</option>
                    <option value="200">200 条/页</option>
                </select>
            </div>
        </div>

        <!-- 邮件列表内容（新增搜索功能） -->
        <div id="mail-list" class="content-section">
            <h1>邮件列表</h1>
            
            <!-- 邮件搜索区域 -->
            <div class="mail-search-section">
                <input type="text" id="mail-search" placeholder="输入发件人或主题关键词搜索...">
                <button onclick="searchMails()">搜索</button>
                <button onclick="clearMailSearch()">清空</button>
            </div>

            <div class="table-container">
                <table class="mail-table" id="mail-table">
                    <thead>
                        <tr>
                            <th>发件人</th>
                            <th>主题</th>
                            <th>日期</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- 数据将动态添加到这里 -->
                    </tbody>
                </table>
            </div>
            <div class="no-data" id="no-data-mail">暂无数据</div>
            <div class="pagination" id="pagination-mail">
                <button onclick="changeMailPage(1)">1</button>
            </div>
        </div>
    </div>

    <!-- 普通模态框 -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <h3 id="modal-title"></h3>
            <p id="modal-message"></p>
            <button onclick="closeModal()">确认</button>
        </div>
    </div>

    <!-- 编辑模态框 -->
    <div class="modal" id="edit-modal">
        <div class="modal-content edit-modal-content">
            <h3>编辑邮箱信息</h3>
            <input type="hidden" id="edit-email-original"> <!-- 存储原始邮箱（不可修改） -->
            <div class="form-group">
                <label for="edit-email">邮箱地址（不可修改）</label>
                <input type="text" id="edit-email" readonly>
            </div>
            <div class="form-group">
                <label for="edit-password">密码</label>
                <input type="text" id="edit-password">
            </div>
            <div class="form-group">
                <label for="edit-client-id">Client ID</label>
                <input type="text" id="edit-client-id">
            </div>
            <div class="form-group">
                <label for="edit-refresh-token">Refresh Token</label>
                <input type="text" id="edit-refresh-token">
            </div>
            <button onclick="saveEdit()">保存</button>
            <button class="cancel" onclick="closeEditModal()">取消</button>
        </div>
    </div>

    <!-- 确认模态框 -->
    <div class="modal" id="confirm-modal">
        <div class="modal-content">
            <h3 id="confirm-title">确认操作</h3>
            <p id="confirm-message"></p>
            <button onclick="confirmAction()">确认</button>
            <button class="cancel" onclick="closeConfirmModal()">取消</button>
        </div>
    </div>

    <!-- 邮件详情模态框 -->
    <div class="mail-modal" id="mail-modal">
        <div class="mail-modal-content">
            <h3 id="mail-modal-title"></h3>
            <p id="mail-modal-sender"></p>
            <p id="mail-modal-subject"></p>
            <p id="mail-modal-date"></p>
            <p id="mail-modal-content"></p>
            <button onclick="closeMailModal()">关闭</button>
        </div>
    </div>

    <script>
        // 加密密钥（可修改，建议至少8位）
        const ENCRYPT_KEY = 'xh_email_system_2024';
        // 全局变量，用于存储邮件数据
        let mailData = [];
        let originalMailData = []; // 存储原始邮件数据（用于搜索重置）
        let currentMailPage = 1; // 当前邮件列表的页码
        const mailItemsPerPage = 10; // 每页显示的邮件数量
        let searchKeyword = ''; // 存储邮箱搜索关键词
        let mailSearchKeyword = ''; // 存储邮件搜索关键词
        let passwordVisible = false; // 密码显示状态
        let confirmCallback = null; // 确认框回调函数

        // 移动端菜单切换
        document.getElementById('menu-toggle').addEventListener('click', function() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('active');
        });

        // 点击侧边栏链接后在移动端自动收起菜单
        document.querySelectorAll('.sidebar ul li a:not(.buy-link)').forEach(link => {
            link.addEventListener('click', function() {
                if (window.innerWidth <= 768) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });
        });

        // 加密函数
        function encryptData(data) {
            return CryptoJS.AES.encrypt(JSON.stringify(data), ENCRYPT_KEY).toString();
        }

        // 解密函数
        function decryptData(cipherText) {
            try {
                const bytes = CryptoJS.AES.decrypt(cipherText, ENCRYPT_KEY);
                return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
            } catch (e) {
                console.error('解密失败', e);
                return null;
            }
        }

        // 显示 Loading
        function showLoading() {
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        // 隐藏 Loading
        function hideLoading() {
            document.getElementById('loading-overlay').style.display = 'none';
        }

        // 获取所有侧边栏链接和内容区域
        const links = document.querySelectorAll('.sidebar ul li a');
        const contentSections = document.querySelectorAll('.content-section');

        // 监听侧边栏链接的点击事件
        links.forEach(link => {
            link.addEventListener('click', (e) => {
                // 购买链接直接跳转，不触发内容切换
                if (link.classList.contains('buy-link')) return;

                e.preventDefault(); // 阻止默认跳转行为

                // 移除所有链接的选中状态
                links.forEach(l => l.classList.remove('active'));
                // 为当前点击的链接添加选中状态
                link.classList.add('active');

                // 获取目标内容区域的ID
                const targetId = link.getAttribute('data-target');
                // 隐藏所有内容区域
                contentSections.forEach(section => section.classList.remove('active'));
                // 显示目标内容区域
                document.getElementById(targetId).classList.add('active');
            });
        });

        // 分页相关变量
        let currentPage = 1;
        let itemsPerPage = 5;

        // 从 localStorage 加载数据（解密）
        function loadData() {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = [];
            if (encryptedData) {
                data = decryptData(encryptedData) || [];
            }
            const encryptedPassword = localStorage.getItem('password') || '';
            if (encryptedPassword) {
                const decryptedPwd = decryptData(encryptedPassword);
                if (decryptedPwd) {
                    document.getElementById('password').value = decryptedPwd;
                }
            }
            // 应用搜索过滤
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            renderTable(filteredData);
            renderPagination(filteredData.length);
            toggleNoData(filteredData.length === 0);
            updateDashboard(data); // 更新仪表盘数据（滑动显示）
        }

        // 渲染表格（密码显示/隐藏支持）
        function renderTable(data) {
            const emailTableBody = document.querySelector('#email-table tbody');
            emailTableBody.innerHTML = '';

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = data.slice(start, end);

            pageData.forEach((item, index) => {
                const row = document.createElement('tr');

                // 添加多选框
                const checkboxCell = document.createElement('td');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.dataset.email = item.email;

                checkboxCell.appendChild(checkbox);
                row.appendChild(checkboxCell);

                // 密码单元格（支持显示/隐藏）
                const passwordCell = document.createElement('td');
                passwordCell.className = 'password-cell';
                const passwordSpan = document.createElement('span');
                passwordSpan.className = 'password-text';
                passwordSpan.textContent = passwordVisible ? item.password : '••••••••';
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'password-toggle';
                toggleBtn.innerHTML = passwordVisible ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
                toggleBtn.onclick = (e) => {
                    e.stopPropagation();
                    const isVisible = passwordSpan.textContent !== '••••••••';
                    passwordSpan.textContent = isVisible ? '••••••••' : item.password;
                    toggleBtn.innerHTML = isVisible ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
                };
                passwordCell.appendChild(passwordSpan);
                passwordCell.appendChild(toggleBtn);

                // 添加其他单元格
                row.appendChild(document.createElement('td')).textContent = item.email;
                row.appendChild(passwordCell);
                row.appendChild(document.createElement('td')).textContent = item.clientId;
                
                const refreshTokenCell = document.createElement('td');
                refreshTokenCell.className = 'refresh-token';
                refreshTokenCell.title = item.refreshToken;
                refreshTokenCell.textContent = item.refreshToken;
                row.appendChild(refreshTokenCell);

                // 操作列（新增编辑按钮）
                const actionsCell = document.createElement('td');
                actionsCell.className = 'actions';
                actionsCell.innerHTML = `
                    <button class="view" onclick="viewInbox(${start + index})">收件箱</button>
                    <button class="view" onclick="viewJunk(${start + index})">垃圾箱</button>
                    <button class="edit" onclick="editEmail(${start + index})">编辑</button>
                    <button class="delete" onclick="showDeleteConfirm(${start + index})">删除</button>
                `;
                row.appendChild(actionsCell);

                emailTableBody.appendChild(row);
            });
        }

        // 全选/全不选功能
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('select-all').addEventListener('change', function () {
                const checkboxes = document.querySelectorAll('#email-table tbody input[type="checkbox"]');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = this.checked;
                });
                updateSelectedItems();
            });

            // 监听多选框的变化
            document.querySelector('#email-table tbody').addEventListener('change', function (event) {
                if (event.target.type === 'checkbox') {
                    updateSelectedItems();
                }
            });

            // 支持回车搜索
            document.getElementById('email-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchEmails();
                }
            });

            // 邮件搜索框支持回车
            document.getElementById('mail-search').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchMails();
                }
            });

            // 页面加载时加载数据
            loadData();
        });

        // 存储选中的项
        let selectedItems = [];

        // 更新选中的项
        function updateSelectedItems() {
            const checkboxes = document.querySelectorAll('#email-table tbody input[type="checkbox"]:checked');
            selectedItems = Array.from(checkboxes).map(checkbox => {
                return checkbox.dataset.email;
            });
        }

        // 批量删除
        function batchDelete() {
            if (selectedItems.length === 0) {
                showModal('提示', '请选择要删除的项！');
                return;
            }

            showConfirmModal(
                '确认批量删除',
                `确定要删除选中的 ${selectedItems.length} 项吗？删除后不可恢复`,
                function() {
                    const encryptedData = localStorage.getItem('emailData') || '';
                    let data = encryptedData ? decryptData(encryptedData) || [] : [];
                    const filteredData = data.filter(item => !selectedItems.includes(item.email));
                    localStorage.setItem('emailData', encryptData(filteredData));
                    loadData();
                    showModal('删除成功', `已删除选中的 ${selectedItems.length} 项邮箱`);
                }
            );
        }

        // 删除全部邮箱
        function deleteAllEmails() {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            if (data.length === 0) {
                showModal('提示', '当前没有邮箱数据可删除！');
                return;
            }

            showConfirmModal(
                '警告',
                '此操作将删除所有邮箱数据，且无法恢复。是否确认删除？',
                function() {
                    localStorage.removeItem('emailData'); // 清空所有邮箱数据
                    loadData(); // 重新加载数据（表格清空，仪表盘更新）
                    showModal('删除成功', '所有邮箱数据已全部删除！');
                }
            );
        }

        // 渲染分页控件
        function renderPagination(totalItems) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(totalItems / itemsPerPage);
            const maxButtons = 5; // 最多显示5个页码按钮

            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage + 1 < maxButtons) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            // 添加“上一页”按钮
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '上一页';
                prevButton.onclick = () => changePage(currentPage - 1);
                pagination.appendChild(prevButton);
            }

            // 添加第一页按钮
            if (startPage > 1) {
                const firstButton = document.createElement('button');
                firstButton.textContent = '1';
                firstButton.onclick = () => changePage(1);
                pagination.appendChild(firstButton);

                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }
            }

            // 添加页码按钮
            for (let i = startPage; i <= endPage; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                if (i === currentPage) {
                    button.classList.add('active');
                }
                button.onclick = () => changePage(i);
                pagination.appendChild(button);
            }

            // 添加最后一页按钮
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    pagination.appendChild(ellipsis);
                }

                const lastButton = document.createElement('button');
                lastButton.textContent = totalPages;
                lastButton.onclick = () => changePage(totalPages);
                pagination.appendChild(lastButton);
            }

            // 添加“下一页”按钮
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = '下一页';
                nextButton.onclick = () => changePage(currentPage + 1);
                pagination.appendChild(nextButton);
            }
        }

        // 切换分页
        function changePage(page) {
            currentPage = page;
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            renderTable(filteredData);
            renderPagination(filteredData.length);
        }

        function changeItemsPerPage(value) {
            itemsPerPage = parseInt(value, 10);
            currentPage = 1; // 切换每页显示条数时重置到第一页
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            renderTable(filteredData);
            renderPagination(filteredData.length);
        }

        // 显示/隐藏无数据提示
        function toggleNoData(isEmpty) {
            const noData = document.getElementById('no-data');
            noData.style.display = isEmpty ? 'block' : 'none';
        }

        // 查看邮件（收件箱）
        function viewInbox(index) {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            const item = filteredData[index];

            // 重置邮件分页为第一页
            currentMailPage = 1;
            mailSearchKeyword = '';
            document.getElementById('mail-search').value = '';

            // 加载邮件列表
            loadMailList(item.refreshToken, item.clientId, item.email, 'INBOX');
        }

        // 查看邮件（垃圾箱）
        function viewJunk(index) {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            const item = filteredData[index];

            // 重置邮件分页为第一页
            currentMailPage = 1;
            mailSearchKeyword = '';
            document.getElementById('mail-search').value = '';

            // 加载邮件列表
            loadMailList(item.refreshToken, item.clientId, item.email, 'Junk');
        }

        // 加载邮件列表（新增原始数据存储）
        function loadMailList(refreshToken, clientId, email, mailbox) {
            showLoading(); // 显示 Loading
            const encryptedPassword = localStorage.getItem('password') || '';
            let password = '';
            if (encryptedPassword) {
                const decryptedPwd = decryptData(encryptedPassword);
                password = decryptedPwd || '';
            }
            const apiUrl = `/api/mail-all?refresh_token=${refreshToken}&client_id=${clientId}&email=${email}&mailbox=${mailbox}&response_type=json&password=${password}`;

            fetch(apiUrl)
                .then(response => {
                    // 检查响应状态码
                    if (!response.ok) {
                        // 如果状态码不是 2xx，抛出错误
                        if (response.status === 500) {
                            // 如果是 500 错误，尝试解析返回的 JSON 数据
                            return response.json().then(errorData => {
                                // 如果返回的错误信息是 "Nothing to fetch"，则设置 mailData 为空
                                if (errorData.error === "Nothing to fetch") {
                                    // 更新全局邮件数据
                                    mailData = [];
                                    originalMailData = [];
                                    // 隐藏其他内容区域
                                    document.querySelectorAll('.content-section').forEach(section => {
                                        section.classList.remove('active');
                                    });
                                    // 显示邮件列表区域
                                    document.getElementById('mail-list').classList.add('active');
                                    // 渲染邮件列表
                                    renderMailTable(mailData);
                                    // 返回一个 resolved 的 Promise，避免进入 catch 块
                                    return Promise.resolve();
                                } else {
                                    // 其他 500 错误
                                    throw new Error('服务器内部错误，请稍后重试。');
                                }
                            });
                        } else {
                            // 其他非 500 错误
                            if (response.status == 401) {
                                throw response;
                            }
                            // 其他非 500 错误
                            throw new Error(`请求失败，状态码：${response.status}`);
                        }
                    }
                    return response.json(); // 解析 JSON 数据
                })
                .then(data => {
                    // 如果 data 存在（即不是 "Nothing to fetch" 的情况），更新全局邮件数据
                    if (data) {
                        mailData = data;
                        originalMailData = [...data]; // 存储原始数据用于搜索

                        // 隐藏其他内容区域
                        document.querySelectorAll('.content-section').forEach(section => {
                            section.classList.remove('active');
                        });
                        // 显示邮件列表区域
                        document.getElementById('mail-list').classList.add('active');
                        // 渲染邮件列表
                        renderMailTable(mailData);
                    }
                })
                .catch(error => {
                    if (error.status == 401) {
                        showModal('提示', '为了防止滥用，已加密码验证。如需使用请购买，请联系管理员小黑QQ：113575320。');
                        return;
                    }

                    // 根据错误类型显示不同的提示
                    if (error.message.includes('服务器内部错误')) {
                        showModal('错误', '服务器内部错误，请稍后重试。');
                    } else {
                        showModal('错误', '无法加载邮件数据，请检查网络连接或稍后重试。');
                    }
                })
                .finally(() => {
                    hideLoading(); // 隐藏 Loading
                });
        }

        // 渲染邮件表格
        function renderMailTable(data) {
            const mailTableBody = document.querySelector('#mail-table tbody');
            mailTableBody.innerHTML = '';

            if (data.length === 0) {
                document.getElementById('no-data-mail').style.display = 'block';
            } else {
                document.getElementById('no-data-mail').style.display = 'none';
            }

            const start = (currentMailPage - 1) * mailItemsPerPage;
            const end = start + mailItemsPerPage;
            const pageData = data.slice(start, end);

            pageData.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.send}</td>
                    <td>${item.subject}</td>
                    <td>${item.date}</td>
                    <td class="actions">
                        <button onclick="viewMail(${start + index})">查看</button>
                    </td>
                `;
                mailTableBody.appendChild(row);
            });

            // 渲染邮件分页
            renderMailPagination(data.length);
        }

        // 渲染邮件分页控件
        function renderMailPagination(totalItems) {
            const pagination = document.getElementById('pagination-mail');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(totalItems / mailItemsPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const button = document.createElement('button');
                button.textContent = i;
                if (i === currentMailPage) {
                    button.classList.add('active');
                }
                button.onclick = () => changeMailPage(i);
                pagination.appendChild(button);
            }
        }

        // 切换邮件分页
        function changeMailPage(page) {
            currentMailPage = page;
            // 根据搜索关键词决定渲染数据
            const renderData = mailSearchKeyword 
                ? originalMailData.filter(item => 
                    item.send.toLowerCase().includes(mailSearchKeyword) || 
                    item.subject.toLowerCase().includes(mailSearchKeyword)
                  )
                : originalMailData;
            renderMailTable(renderData);
        }

        // 邮件搜索功能
        function searchMails() {
            mailSearchKeyword = document.getElementById('mail-search').value.trim().toLowerCase();
            currentMailPage = 1; // 搜索后重置到第一页
            const filteredData = originalMailData.filter(item => 
                item.send.toLowerCase().includes(mailSearchKeyword) || 
                item.subject.toLowerCase().includes(mailSearchKeyword)
            );
            renderMailTable(filteredData);
        }

        // 清空邮件搜索
        function clearMailSearch() {
            document.getElementById('mail-search').value = '';
            mailSearchKeyword = '';
            currentMailPage = 1;
            renderMailTable(originalMailData);
        }

        // 查看邮件详情
        function viewMail(index) {
            // 根据搜索状态获取正确的邮件数据
            const targetData = mailSearchKeyword 
                ? originalMailData.filter(item => 
                    item.send.toLowerCase().includes(mailSearchKeyword) || 
                    item.subject.toLowerCase().includes(mailSearchKeyword)
                  )[index]
                : originalMailData[index];

            if (targetData) {
                document.getElementById('mail-modal-title').textContent = targetData.subject;
                document.getElementById('mail-modal-sender').textContent = `发件人: ${targetData.send}`;
                document.getElementById('mail-modal-subject').textContent = `主题: ${targetData.subject}`;
                document.getElementById('mail-modal-date').textContent = `日期: ${targetData.date}`;
                document.getElementById('mail-modal-content').innerHTML = `内容: ${targetData.html || targetData.text}`;
                document.getElementById('mail-modal').style.display = 'flex';
            } else {
                console.error('邮件数据不存在:', index);
            }
        }

        // 关闭邮件详情模态框
        function closeMailModal() {
            document.getElementById('mail-modal').style.display = 'none';
        }

        // 显示删除确认框
        function showDeleteConfirm(index) {
            confirmCallback = function() {
                deleteEmail(index);
            };
            document.getElementById('confirm-title').textContent = '确认删除';
            document.getElementById('confirm-message').textContent = '确定要删除该邮箱吗？删除后不可恢复';
            document.getElementById('confirm-modal').style.display = 'flex';
        }

        // 删除单个邮箱
        function deleteEmail(index) {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            
            // 找到原始数据中的索引
            const originalIndex = data.findIndex(item => item.email === filteredData[index].email);
            if (originalIndex !== -1) {
                const deletedEmail = data[originalIndex].email;
                data.splice(originalIndex, 1); // 删除指定项
                localStorage.setItem('emailData', encryptData(data)); // 加密存储
                loadData(); // 重新加载数据
                showModal('删除成功', `邮箱 ${deletedEmail} 已成功删除`);
            }
        }

        // 导入邮箱功能（去重+加密存储）
        function importEmails() {
            const delimiter = document.getElementById('delimiter').value.trim();
            const fileInput = document.getElementById('file-input');

            if (!delimiter) {
                showModal('错误', '请输入分隔符！');
                return;
            }

            if (fileInput.files.length === 0) {
                showModal('错误', '请选择文件！');
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (e) {
                showLoading();
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim() !== ''); // 过滤空行
                const encryptedData = localStorage.getItem('emailData') || '';
                let data = encryptedData ? decryptData(encryptedData) || [] : [];
                const existingEmails = new Set(data.map(item => item.email.toLowerCase()));
                let successCount = 0;
                let duplicateCount = 0;
                let errorCount = 0;

                // 解析每一行
                lines.forEach(line => {
                    const fields = line.split(delimiter).map(field => field.trim()); // 分割并去空格
                    if (fields.length >= 4) { // 确保有 4 个字段
                        const email = fields[0].trim();
                        const password = fields[1].trim();
                        const clientId = fields[2].trim();
                        const refreshToken = fields[3].trim();
                        if (email && password && clientId && refreshToken) {
                            if (existingEmails.has(email.toLowerCase())) {
                                duplicateCount++;
                                return;
                            }
                            data.push({ email, password, clientId, refreshToken });
                            existingEmails.add(email.toLowerCase());
                            successCount++;
                        } else {
                            errorCount++;
                        }
                    } else {
                        errorCount++;
                    }
                });

                // 保存到 localStorage（加密）
                localStorage.setItem('emailData', encryptData(data));
                // 重新加载数据
                loadData();
                hideLoading();

                // 显示详细导入结果
                showModal(
                    '导入完成',
                    `成功导入：${successCount} 条<br>重复跳过：${duplicateCount} 条<br>格式错误：${errorCount} 条`
                );

                // 清空文件选择
                fileInput.value = '';
                document.getElementById('file-info').textContent = '';
            };

            reader.readAsText(file);
        }

        // 拖拽文件上传逻辑
        const uploadBox = document.getElementById('upload-box');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');

        // 点击上传区域触发文件选择
        uploadBox.addEventListener('click', () => {
            fileInput.click();
        });

        // 文件选择后显示文件名
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                fileInfo.textContent = `已选择文件：${fileInput.files[0].name}`;
            }
        });

        // 拖拽文件进入区域
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        // 拖拽文件离开区域
        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        // 拖拽文件释放
        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files; // 将拖拽的文件赋值给 input
                fileInfo.textContent = `已选择文件：${files[0].name}`;
            }
        });

        // 模态框功能
        const modal = document.getElementById('modal');
        const confirmModal = document.getElementById('confirm-modal');
        const editModal = document.getElementById('edit-modal');

        // 显示普通模态框
        function showModal(title, message) {
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').innerHTML = message;
            modal.style.display = 'flex';
        }

        // 显示确认模态框
        function showConfirmModal(title, message, callback) {
            confirmCallback = callback;
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            confirmModal.style.display = 'flex';
        }

        // 确认操作
        function confirmAction() {
            if (typeof confirmCallback === 'function') {
                confirmCallback();
            }
            closeConfirmModal();
        }

        // 关闭普通模态框
        function closeModal() {
            modal.style.display = 'none';
        }

        // 关闭确认模态框
        function closeConfirmModal() {
            confirmModal.style.display = 'none';
            confirmCallback = null;
        }

        // 打开编辑模态框
        function editEmail(index) {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            const item = filteredData[index];

            if (item) {
                document.getElementById('edit-email-original').value = item.email;
                document.getElementById('edit-email').value = item.email;
                document.getElementById('edit-password').value = item.password;
                document.getElementById('edit-client-id').value = item.clientId;
                document.getElementById('edit-refresh-token').value = item.refreshToken;
                editModal.style.display = 'flex';
            }
        }

        // 关闭编辑模态框
        function closeEditModal() {
            editModal.style.display = 'none';
        }

        // 保存编辑内容
        function saveEdit() {
            const originalEmail = document.getElementById('edit-email-original').value.trim();
            const password = document.getElementById('edit-password').value.trim();
            const clientId = document.getElementById('edit-client-id').value.trim();
            const refreshToken = document.getElementById('edit-refresh-token').value.trim();

            if (!password || !clientId || !refreshToken) {
                showModal('错误', '密码、Client ID、Refresh Token 不能为空！');
                return;
            }

            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const index = data.findIndex(item => item.email === originalEmail);

            if (index !== -1) {
                data[index].password = password;
                data[index].clientId = clientId;
                data[index].refreshToken = refreshToken;
                localStorage.setItem('emailData', encryptData(data));
                loadData();
                closeEditModal();
                showModal('编辑成功', `邮箱 ${originalEmail} 信息已更新`);
            } else {
                showModal('错误', '未找到该邮箱数据！');
            }
        }

        // 导出数据备份
        function exportData() {
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];

            if (data.length === 0) {
                showModal('提示', '当前没有邮箱数据可导出！');
                return;
            }

            // 转换为JSON字符串
            const jsonStr = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `邮箱数据备份_${new Date().toLocaleDateString().replace(/\//g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showModal('导出成功', '数据已导出为JSON文件，建议妥善保存');
        }

        // 切换所有密码显示/隐藏
        function toggleAllPasswords() {
            passwordVisible = !passwordVisible;
            const passwordTexts = document.querySelectorAll('.password-text');
            const toggleBtns = document.querySelectorAll('.password-toggle:not(.edit-modal-content .password-toggle)');
            
            passwordTexts.forEach((span, index) => {
                const row = span.closest('tr');
                const email = row.cells[1].textContent;
                const encryptedData = localStorage.getItem('emailData') || '';
                let data = encryptedData ? decryptData(encryptedData) || [] : [];
                const item = data.find(item => item.email === email);
                if (item) {
                    span.textContent = passwordVisible ? item.password : '••••••••';
                }
                toggleBtns[index].innerHTML = passwordVisible ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
            });

            // 更新表头按钮
            const headerBtn = document.querySelector('th .password-toggle i');
            headerBtn.className = passwordVisible ? 'fas fa-eye-slash' : 'fas fa-eye';
        }

        // 数字滑动（滚动）显示函数
        function animateValue(id, start, end, duration) {
            let startTimestamp = null;
            const element = document.getElementById(id);
            const step = (timestamp) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                element.textContent = value;
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        // 更新仪表盘数据（使用滑动显示）
        function updateDashboard(data) {
            const accountCount = data.length;
            // 从0滚动到实际数量， duration=800ms（可调整速度）
            animateValue('account-count', 0, accountCount, 800);
        }

        // 搜索邮箱
        function searchEmails() {
            searchKeyword = document.getElementById('email-search').value.trim().toLowerCase();
            currentPage = 1; // 搜索后重置到第一页
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            const filteredData = searchKeyword ? data.filter(item => 
                item.email.toLowerCase().includes(searchKeyword)
            ) : data;
            renderTable(filteredData);
            renderPagination(filteredData.length);
            toggleNoData(filteredData.length === 0);
        }

        // 清空搜索
        function clearSearch() {
            document.getElementById('email-search').value = '';
            searchKeyword = '';
            currentPage = 1;
            const encryptedData = localStorage.getItem('emailData') || '';
            let data = encryptedData ? decryptData(encryptedData) || [] : [];
            renderTable(data);
            renderPagination(data.length);
            toggleNoData(data.length === 0);
        }

        // 设置密码（加密存储）
        function setPassword() {
            const password = document.getElementById('password').value.trim();
            if (password) {
                localStorage.setItem('password', encryptData(password));
            } else {
                localStorage.removeItem('password');
            }
        }

        // 点击模态框外部关闭
        window.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
            if (e.target === confirmModal) closeConfirmModal();
            if (e.target === editModal) closeEditModal();
            if (e.target === document.getElementById('mail-modal')) closeMailModal();
        });

        // 窗口大小变化时处理
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('active'); // 大屏幕自动收起菜单
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            console.log('%c感谢您使用本项目！', 'color: #999; font-size: 11px; margin-top: 5px; margin-bottom: 5px;');
            console.log('%c作者: HChaohui', 'color: #3498db; font-size: 12px; font-weight: bold; margin-bottom: 5px;');
            console.log('%c开源地址: %chttps://github.com/HChaoHui/msOauth2api', 'color: #3498db; font-size: 12px; font-weight: bold;', 'color: #3498db; font-size: 12px; text-decoration: underline; cursor: pointer;');
            console.log('%c如需使用或修改本项目，请保留作者信息。感谢您的理解和支持！', 'color: #999; font-size: 11px; margin-top: 5px; margin-bottom: 5px;');
        });
    </script>

</body>

</html>
