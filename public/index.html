<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>小黑邮箱管理系统 QQ:113575320</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;display:flex;background-color:#121212;overflow-x:hidden;}
.sidebar{width:250px;background-color:#1e1e1e;color:#e0e0e0;height:100vh;padding:20px;box-sizing:border-box;box-shadow:2px 0 10px rgba(0,0,0,0.5);transition:transform 0.3s ease;position:fixed;z-index:100;}
.sidebar h2{text-align:center;margin-bottom:30px;font-size:24px;color:#3498db;}
.sidebar ul{list-style-type:none;padding:0;}
.sidebar ul li{margin:10px 0;}
.sidebar ul li a{color:#e0e0e0;text-decoration:none;display:flex;align-items:center;padding:12px 15px;border-radius:8px;transition:all 0.3s ease;}
.sidebar ul li a:hover{background-color:#3498db;color:#ffffff;transform:translateX(5px);}
.sidebar ul li a.active{background-color:#3498db;color:#ffffff;font-weight:bold;}
.sidebar ul li a i{margin-right:10px;font-size:18px;}
.sidebar ul li .buy-link{background-color:#3498db;color:#ffffff;font-weight:bold;}
.sidebar ul li .buy-link:hover{background-color:#2980b9;transform:translateX(5px);}
.content{flex-grow:1;padding:30px;background-color:#121212;margin-left:250px;transition:margin-left 0.3s ease;min-height:100vh;box-sizing:border-box;}
.menu-toggle{display:none;position:fixed;top:15px;left:15px;z-index:101;background-color:#3498db;color:white;border:none;width:40px;height:40px;border-radius:50%;font-size:20px;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,0.3);}
.mail-search-section{margin:20px 0;display:flex;align-items:center;flex-wrap:wrap;gap:10px;}
.mail-search-section input[type="text"]{padding:8px;border:1px solid #444;border-radius:4px;width:300px;margin-right:10px;background-color:#2d2d2d;color:#e0e0e0;}
.mail-search-section button{padding:8px 16px;background-color:#3498db;color:#ffffff;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;}
.mail-search-section button:hover{background-color:#2980b9;}
.mail-search-section button:nth-child(3){background-color:#4a4a4a;margin-left:10px;}
.mail-search-section button:nth-child(3):hover{background-color:#5f5f5f;}
.content-section{display:none;animation:fadeIn 0.5s ease;}
.content-section.active{display:block;}
.dashboard-cards{display:flex;gap:20px;margin-bottom:30px;flex-wrap:wrap;}
.dashboard-card{background-color:#1e1e1e;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.5);flex:1;min-width:200px;text-align:center;border:1px solid #333;}
.dashboard-card h3{margin:0;font-size:18px;color:#e0e0e0;}
.dashboard-card p{margin:10px 0 0;font-size:24px;color:#3498db;font-weight:bold;}
.quick-actions{margin-top:30px;display:flex;gap:10px;flex-wrap:wrap;}
.quick-actions a{flex:1;min-width:140px;padding:12px;background:#3498db;color:white;text-align:center;border-radius:8px;text-decoration:none;transition:background-color 0.3s ease;display:flex;align-items:center;justify-content:center;gap:8px;}
.quick-actions a:hover{background-color:#2980b9;}
.upload-section{background-color:#1e1e1e;padding:20px;border-radius:8px;box-shadow:0 2px 4px rgba(0,0,0,0.5);margin-bottom:20px;border:1px solid #333;}
.upload-section .upload-box{border:2px dashed #3498db;border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:background-color 0.3s ease;}
.upload-section .upload-box.dragover{background-color:#2d3436;border-color:#2980b9;}
.upload-section .upload-box i{font-size:24px;color:#3498db;margin-bottom:10px;}
.upload-section .upload-box p{margin:0;color:#999999;}
.upload-section .upload-box .file-info{margin-top:10px;font-size:14px;color:#3498db;}
.upload-section .upload-box input[type="file"]{display:none;}
.upload-section .delimiter-input{margin-top:20px;display:flex;align-items:center;justify-content:center;flex-wrap:wrap;gap:10px;}
.upload-section .delimiter-input input[type="text"],.upload-section .delimiter-input input[type="password"]{padding:8px;border:1px solid #444;border-radius:4px;width:200px;background-color:#2d2d2d;color:#e0e0e0;}
.upload-section .delimiter-input button{padding:8px 16px;background-color:#3498db;color:#ffffff;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;}
.upload-section .delimiter-input button:hover{background-color:#2980b9;}
.search-section{margin:20px 0;display:flex;align-items:center;flex-wrap:wrap;gap:10px;}
.search-section input[type="text"]{padding:8px;border:1px solid #444;border-radius:4px;width:300px;background-color:#2d2d2d;color:#e0e0e0;}
.search-section button{padding:8px 16px;background-color:#3498db;color:#ffffff;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;}
.search-section button:hover{background-color:#2980b9;}
.search-section button:nth-child(3){background-color:#4a4a4a;}
.search-section button:nth-child(3):hover{background-color:#5f5f5f;}
.table-container{overflow-x:auto;margin-top:20px;}
.email-table,.mail-table{width:100%;min-width:768px;border-collapse:collapse;background-color:#1e1e1e;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px rgba(0,0,0,0.5);border:1px solid #333;}
.email-table th,.email-table td,.mail-table th,.mail-table td{padding:12px 15px;text-align:left;border-bottom:1px solid #333;font-size:14px;color:#e0e0e0;}
.email-table th,.mail-table th{background-color:#2d2d2d;color:#ffffff;font-weight:bold;}
.email-table tr:hover,.mail-table tr:hover{background-color:#2d3436;}
.email-table td,.mail-table td{word-wrap:break-word;}
.email-table .refresh-token{max-width:150px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.email-table .actions,.mail-table .actions{white-space:nowrap;display:flex;gap:5px;}
.email-table .actions button,.mail-table .actions button{padding:6px 12px;border:none;border-radius:4px;cursor:pointer;font-size:12px;transition:background-color 0.3s ease;}
.email-table .actions button.view,.mail-table .actions button.view{background-color:#3498db;color:#ffffff;}
.email-table .actions button.edit{background-color:#27ae60;color:#ffffff;}
.email-table .actions button.edit:hover{background-color:#219653;}
.email-table .actions button.delete,.mail-table .actions button.delete{background-color:#e74c3c;color:#ffffff;}
.email-table .actions button:hover,.mail-table .actions button:hover{opacity:0.9;}
.password-toggle{background:transparent;border:none;color:#3498db;cursor:pointer;font-size:12px;padding:0 5px;}
.pagination{margin-top:20px;display:flex;justify-content:center;align-items:center;flex-wrap:wrap;gap:5px;}
.pagination button{padding:6px 12px;margin:0 5px;border:1px solid #3498db;border-radius:4px;background-color:#1e1e1e;color:#3498db;cursor:pointer;transition:background-color 0.3s ease;}
.pagination button.active{background-color:#3498db;color:#ffffff;}
.pagination button:hover{background-color:#3498db;color:#ffffff;}
.no-data{text-align:center;padding:20px;color:#999999;font-size:16px;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;}
.modal-content{background-color:#1e1e1e;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.5);max-width:400px;width:90%;text-align:center;border:1px solid #333;}
.modal-content h3{margin-top:0;color:#e0e0e0;}
.modal-content p{color:#999999;}
.modal-content button{padding:8px 16px;background-color:#3498db;color:#ffffff;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;margin:0 5px;}
.modal-content button.cancel{background-color:#4a4a4a;}
.modal-content button:hover{background-color:#2980b9;}
.modal-content button.cancel:hover{background-color:#5f5f5f;}
.edit-modal-content{max-width:500px;}
.edit-modal-content .form-group{margin:15px 0;text-align:left;}
.edit-modal-content label{display:block;margin-bottom:5px;color:#e0e0e0;}
.edit-modal-content input{width:100%;padding:8px;border:1px solid #444;border-radius:4px;background-color:#2d2d2d;color:#e0e0e0;box-sizing:border-box;}
.mail-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;}
.mail-modal-content{background-color:#1e1e1e;padding:20px;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.5);max-width:600px;width:90%;max-height:80vh;overflow-y:auto;position:relative;border:1px solid #333;}
.mail-modal-content h3{margin-top:0;color:#e0e0e0;}
.mail-modal-content p{color:#999999;word-wrap:break-word;}
.mail-modal-content button{padding:8px 16px;background-color:#3498db;color:#ffffff;border:none;border-radius:4px;cursor:pointer;transition:background-color 0.3s ease;position:sticky;bottom:0;width:100%;margin-top:20px;}
.mail-modal-content button:hover{background-color:#2980b9;}
.loading-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.7);justify-content:center;align-items:center;z-index:1000;}
.loading-spinner{border:4px solid #333;border-top:4px solid #3498db;border-radius:50%;width:40px;height:40px;animation:spin 1s linear infinite;}
@keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
.email-handel{display:flex;align-items:center;}
.email-handel .delimiter-input{justify-content:left;margin-top:0px;}
.delete-btn{background-color:#e74c3c !important;margin-left:10px !important;}
.delete-btn:hover{background-color:#e74c3c !important;opacity:0.9 !important;}
.delete-all-btn{background-color:#c0392b !important;margin-left:10px !important;}
.delete-all-btn:hover{background-color:#a5281b !important;opacity:0.9 !important;}
.pagination-section{display:flex;align-items:center;justify-content:center;margin-top:20px;gap:15px;flex-wrap:wrap;}
.pagination-section .pagination{margin-top:0px;}
#items-per-page{padding:6px 15px;border:1px solid #444;border-radius:5px;background-color:#2d2d2d;color:#e0e0e0;font-size:16px;appearance:none;-webkit-appearance:none;-moz-appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" fill="none" stroke="%23e0e0e0" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></svg>');background-repeat:no-repeat;background-position:right 10px center;cursor:pointer;transition:border-color 0.3s ease;}
.export-btn{background-color:#f39c12 !important;margin-left:10px !important;}
.export-btn:hover{background-color:#e67e22 !important;opacity:0.9 !important;}
@media (max-width:768px){
.sidebar{transform:translateX(-100%);width:220px !important;}
.sidebar.active{transform:translateX(0);}
.content{margin-left:0;padding:15px 10px !important;padding-top:60px;}
.menu-toggle{display:block;}
.dashboard-cards{flex-direction:column;}
.dashboard-card{width:100%;min-width:auto;}
.upload-section .delimiter-input{flex-direction:column;align-items:stretch;}
.upload-section .delimiter-input input[type="text"],.upload-section .delimiter-input input[type="password"]{width:100%;margin-right:0;}
.search-section,.mail-search-section{flex-direction:column;align-items:stretch;}
.search-section input[type="text"],.mail-search-section input[type="text"]{width:100%;margin-right:0;}
.search-section button,.mail-search-section button{width:100%;margin-left:0;}
.pagination-section{flex-direction:column;gap:10px;}
.email-table .actions,.mail-table .actions{flex-wrap:wrap;}
.email-table .actions button,.mail-table .actions button{flex:1;margin-bottom:5px;margin-right:0;}
.email-table,.mail-table{min-width:320px !important;}
.email-table th,.email-table td,.mail-table th,.mail-table td{padding:8px 10px !important;font-size:13px !important;}
.quick-actions{flex-direction:column;}
.quick-actions a{width:100%;min-width:auto;}
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/crypto-js@4.2.0/crypto-js.min.js"></script>
</head>
<body>
<button class="menu-toggle" id="menu-toggle"><i class="fas fa-bars"></i></button>
<div class="loading-overlay" id="loading-overlay"><div class="loading-spinner"></div></div>
<div class="sidebar" id="sidebar">
<h2>小黑邮箱管理系统 QQ:113575320</h2>
<ul>
<li><a href="#" data-target="dashboard" class="active"><i class="fas fa-tachometer-alt"></i>仪表盘</a></li>
<li><a href="#" data-target="emails"><i class="fas fa-envelope"></i>邮箱管理</a></li>
<li><a href="https://68n.cn/8to6G" target="_blank" class="buy-link"><i class="fas fa-shopping-cart"></i>购买长效微软邮箱</a></li>
<li><a href="https://xiaoheifk.cn/qj.html" target="_blank" class="buy-link"><i class="fas fa-link"></i>邮箱API生成工具</a></li>
<li><a href="https://wwik.lanzouu.com/iq5Mh39ml3sh" target="_blank" class="buy-link"><i class="fas fa-sync-alt"></i>微软令牌刷新工具</a></li>
<li><a href="https://wwik.lanzouu.com/iTnxu3anj2tc" target="_blank" class="buy-link"><i class="fas fa-key"></i>微软令牌授权工具</a></li>
<li><a href="https://link3.cc/hzqds888" target="_blank" class="buy-link"><i class="fas fa-th-large"></i>更多软件工具合集</a></li>
<!-- 新增查重去重删除工具按钮 -->
<li><a href="https://xiaoheifk.cn/qc.html" target="_blank" class="buy-link"><i class="fas fa-filter"></i>查重去重删除工具</a></li>
<li><a href="https://xiaoheifk.cn/api.html" target="_blank" class="buy-link"><i class="fas fa-file-alt"></i>api调用文档教程</a></li>
<li><a href="https://www.qianxun1688.com/rights-shop/1CDFE3FC" target="_blank" class="buy-link"><i class="fas fa-ticket-alt"></i>全网会员5折优惠网</a></li>
</ul>
</div>
<div class="content">
<div id="dashboard" class="content-section active">
<h1 style="color: #3498db; font-weight: bold;">邮箱总数</h1>
<div class="dashboard-cards">
<div class="dashboard-card">
<h3>账号数量</h3>
<p id="account-count">0</p>
</div>
</div>
<div class="quick-actions">
<a href="#" data-target="emails"><i class="fas fa-envelope"></i> 邮箱管理</a>
<a href="https://68n.cn/8to6G" target="_blank"><i class="fas fa-shopping-cart"></i> 购买邮箱</a>
<a href="https://xiaoheifk.cn/qj.html" target="_blank"><i class="fas fa-link"></i> 邮箱API生成工具</a>
<a href="https://wwik.lanzouu.com/iq5Mh39ml3sh" target="_blank"><i class="fas fa-sync-alt"></i> 令牌刷新工具</a>
<a href="https://wwik.lanzouu.com/iTnxu3anj2tc" target="_blank"><i class="fas fa-key"></i> 令牌授权工具</a>
<a href="https://link3.cc/hzqds888" target="_blank"><i class="fas fa-th-large"></i> 更多工具</a>
<a href="https://xiaoheifk.cn/qc.html" target="_blank"><i class="fas fa-filter"></i> 查重去重删除工具</a>
<a href="https://xiaoheifk.cn/api.html" target="_blank"><i class="fas fa-file-alt"></i> api调用文档</a>
<a href="https://www.qianxun1688.com/rights-shop/1CDFE3FC" target="_blank"><i class="fas fa-ticket-alt"></i> 会员优惠网</a>
</div>
</div>
<div id="emails" class="content-section">
<h1 style="color: #3498db; font-weight: bold;">邮箱管理</h1>
<div class="upload-section">
<div class="upload-box" id="upload-box">
<i class="fas fa-cloud-upload-alt"></i>
<p>点击或拖拽文件到此处上传</p>
<div class="file-info" id="file-info"></div>
<input type="file" id="file-input" accept=".txt">
</div>
<div class="delimiter-input">
<input type="password" id="password" placeholder="输入验证密码 请联系小黑" oninput="setPassword()">
<input type="text" id="delimiter" placeholder="输入分隔符（如 ----）">
<button onclick="importEmails()">导入邮箱</button>
<button class="export-btn" onclick="exportData()">导出为TXT</button>
<button class="delete-btn" onclick="batchDelete()">批量删除</button>
<button class="delete-all-btn" onclick="deleteAllEmails()">删除全部邮箱</button>
</div>
</div>
<div class="search-section">
<input type="text" id="email-search" placeholder="输入邮箱关键词搜索...">
<button onclick="searchEmails()">搜索</button>
<button onclick="clearSearch()">清空</button>
</div>
<div class="table-container">
<table class="email-table" id="email-table">
<thead>
<tr>
<th><input type="checkbox" id="select-all"></th>
<th>Email</th>
<th>Password <button class="password-toggle" onclick="toggleAllPasswords()"><i class="fas fa-eye"></i></button></th>
<th>Client ID</th>
<th>Refresh Token</th>
<th>操作</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="no-data" id="no-data">暂无数据</div>
<div class="pagination-section">
<div class="pagination" id="pagination">
<button onclick="changePage(1)">1</button>
</div>
<select id="items-per-page" onchange="changeItemsPerPage(this.value)">
<option value="5">5 条/页</option>
<option value="10">10 条/页</option>
<option value="20">20 条/页</option>
<option value="50">50 条/页</option>
<option value="100">100 条/页</option>
<option value="200">200 条/页</option>
<option value="500">500 条/页</option>
<option value="5000">5000 条/页</option>
<option value="10000">10000 条/页</option>
</select>
</div>
</div>
<div id="mail-list" class="content-section">
<h1>邮件列表</h1>
<div class="mail-search-section">
<input type="text" id="mail-search" placeholder="输入发件人或主题关键词搜索...">
<button onclick="searchMails()">搜索</button>
<button onclick="clearMailSearch()">清空</button>
</div>
<div class="table-container">
<table class="mail-table" id="mail-table">
<thead>
<tr>
<th>发件人</th>
<th>主题</th>
<th>日期</th>
<th>操作</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>
<div class="no-data" id="no-data-mail">暂无数据</div>
<div class="pagination" id="pagination-mail">
<button onclick="changeMailPage(1)">1</button>
</div>
</div>
</div>
<div class="modal" id="modal">
<div class="modal-content">
<h3 id="modal-title"></h3>
<p id="modal-message"></p>
<button onclick="closeModal()">确认</button>
</div>
</div>
<div class="modal" id="edit-modal">
<div class="modal-content edit-modal-content">
<h3>编辑邮箱信息</h3>
<input type="hidden" id="edit-email-original">
<div class="form-group">
<label for="edit-email">邮箱地址（不可修改）</label>
<input type="text" id="edit-email" readonly>
</div>
<div class="form-group">
<label for="edit-password">密码</label>
<input type="text" id="edit-password">
</div>
<div class="form-group">
<label for="edit-client-id">Client ID</label>
<input type="text" id="edit-client-id">
</div>
<div class="form-group">
<label for="edit-refresh-token">Refresh Token</label>
<input type="text" id="edit-refresh-token">
</div>
<button onclick="saveEdit()">保存</button>
<button class="cancel" onclick="closeEditModal()">取消</button>
</div>
</div>
<div class="modal" id="confirm-modal">
<div class="modal-content">
<h3 id="confirm-title">确认操作</h3>
<p id="confirm-message"></p>
<button onclick="confirmAction()">确认</button>
<button class="cancel" onclick="closeConfirmModal()">取消</button>
</div>
</div>
<div class="mail-modal" id="mail-modal">
<div class="mail-modal-content">
<h3 id="mail-modal-title"></h3>
<p id="mail-modal-sender"></p>
<p id="mail-modal-subject"></p>
<p id="mail-modal-date"></p>
<p id="mail-modal-content"></p>
<button onclick="closeMailModal()">关闭</button>
</div>
</div>
<script>
const ENCRYPT_KEY='xh_email_system_2024';
let mailData=[];
let originalMailData=[];
let currentMailPage=1;
const mailItemsPerPage=10;
let searchKeyword='';
let mailSearchKeyword='';
let passwordVisible=false;
let confirmCallback=null;
document.addEventListener('DOMContentLoaded',function(){
initSidebarLinks();
initQuickActions();
initSelectAll();
initDragUpload();
initSearchEnter();
loadData();
initWindowResize();
initDevInfo();
});
function initSidebarLinks(){
document.querySelectorAll('.sidebar ul li a').forEach(link=>{
link.addEventListener('click',function(e){
if(this.hasAttribute('target')&&this.target==='_blank'){return;}
e.preventDefault();
document.querySelectorAll('.sidebar ul li a').forEach(l=>l.classList.remove('active'));
this.classList.add('active');
const targetId=this.getAttribute('data-target');
if(!targetId)return;
document.querySelectorAll('.content-section').forEach(section=>{section.classList.remove('active');});
const targetSection=document.getElementById(targetId);
if(targetSection){targetSection.classList.add('active');}
if(window.innerWidth<=768){document.getElementById('sidebar').classList.remove('active');}
});
});
}
function initQuickActions(){
document.querySelectorAll('.quick-actions a').forEach(link=>{
link.addEventListener('click',function(e){
if(this.hasAttribute('target')&&this.target==='_blank'){return;}
e.preventDefault();
const targetId=this.getAttribute('data-target');
if(!targetId)return;
document.querySelectorAll('.sidebar ul li a').forEach(l=>l.classList.remove('active'));
document.querySelector(`.sidebar ul li a[data-target="${targetId}"]`).classList.add('active');
document.querySelectorAll('.content-section').forEach(section=>{section.classList.remove('active');});
const targetSection=document.getElementById(targetId);
if(targetSection){targetSection.classList.add('active');}
});
});
}
document.getElementById('menu-toggle').addEventListener('click',function(){
const sidebar=document.getElementById('sidebar');
sidebar.classList.toggle('active');
});
function encryptData(data){return CryptoJS.AES.encrypt(JSON.stringify(data),ENCRYPT_KEY).toString();}
function decryptData(cipherText){
try{const bytes=CryptoJS.AES.decrypt(cipherText,ENCRYPT_KEY);return JSON.parse(bytes.toString(CryptoJS.enc.Utf8));}
catch(e){console.error('解密失败',e);return null;}
}
function showLoading(){document.getElementById('loading-overlay').style.display='flex';}
function hideLoading(){document.getElementById('loading-overlay').style.display='none';}
let currentPage=1;
let itemsPerPage=5;
function loadData(){
const encryptedData=localStorage.getItem('emailData')||'';
let data=[];
if(encryptedData){data=decryptData(encryptedData)||[];}
const encryptedPassword=localStorage.getItem('password')||'';
if(encryptedPassword){const decryptedPwd=decryptData(encryptedPassword);if(decryptedPwd){document.getElementById('password').value=decryptedPwd;}}
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
renderTable(filteredData);
renderPagination(filteredData.length);
toggleNoData(filteredData.length===0);
updateDashboard(data);
}
function renderTable(data){
const emailTableBody=document.querySelector('#email-table tbody');
emailTableBody.innerHTML='';
const start=(currentPage-1)*itemsPerPage;
const end=start+itemsPerPage;
const pageData=data.slice(start,end);
pageData.forEach((item,index)=>{
const row=document.createElement('tr');
const checkboxCell=document.createElement('td');
const checkbox=document.createElement('input');
checkbox.type='checkbox';
checkbox.dataset.email=item.email;
checkboxCell.appendChild(checkbox);
row.appendChild(checkboxCell);
const passwordCell=document.createElement('td');
passwordCell.className='password-cell';
const passwordSpan=document.createElement('span');
passwordSpan.className='password-text';
passwordSpan.textContent=passwordVisible?item.password:'••••••••';
const toggleBtn=document.createElement('button');
toggleBtn.className='password-toggle';
toggleBtn.innerHTML=passwordVisible?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>';
toggleBtn.onclick=(e)=>{
e.stopPropagation();
const isVisible=passwordSpan.textContent!=='••••••••';
passwordSpan.textContent=isVisible?'••••••••':item.password;
toggleBtn.innerHTML=isVisible?'<i class="fas fa-eye"></i>':'<i class="fas fa-eye-slash"></i>';
};
passwordCell.appendChild(passwordSpan);
passwordCell.appendChild(toggleBtn);
row.appendChild(document.createElement('td')).textContent=item.email;
row.appendChild(passwordCell);
row.appendChild(document.createElement('td')).textContent=item.clientId;
const refreshTokenCell=document.createElement('td');
refreshTokenCell.className='refresh-token';
refreshTokenCell.title=item.refreshToken;
refreshTokenCell.textContent=item.refreshToken;
row.appendChild(refreshTokenCell);
const actionsCell=document.createElement('td');
actionsCell.className='actions';
actionsCell.innerHTML=`
<button class="view" onclick="viewInbox(${start + index})">收件箱</button>
<button class="view" onclick="viewJunk(${start + index})">垃圾箱</button>
<button class="edit" onclick="editEmail(${start + index})">编辑</button>
<button class="delete" onclick="showDeleteConfirm(${start + index})">删除</button>
`;
row.appendChild(actionsCell);
emailTableBody.appendChild(row);
});
}
function initSelectAll(){
document.getElementById('select-all').addEventListener('change',function(){
const checkboxes=document.querySelectorAll('#email-table tbody input[type="checkbox"]');
checkboxes.forEach(checkbox=>{checkbox.checked=this.checked;});
updateSelectedItems();
});
document.querySelector('#email-table tbody').addEventListener('change',function(event){
if(event.target.type==='checkbox'){updateSelectedItems();}
});
}
let selectedItems=[];
function updateSelectedItems(){
const checkboxes=document.querySelectorAll('#email-table tbody input[type="checkbox"]:checked');
selectedItems=Array.from(checkboxes).map(checkbox=>{return checkbox.dataset.email;});
}
function batchDelete(){
if(selectedItems.length===0){showModal('提示','请选择要删除的项！');return;}
showConfirmModal('确认批量删除',`确定要删除选中的 ${selectedItems.length} 项吗？删除后不可恢复`,function(){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=data.filter(item=>!selectedItems.includes(item.email));
localStorage.setItem('emailData',encryptData(filteredData));
loadData();
showModal('删除成功',`已删除选中的 ${selectedItems.length} 项邮箱`);
});
}
function deleteAllEmails(){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
if(data.length===0){showModal('提示','当前没有邮箱数据可删除！');return;}
showConfirmModal('警告','此操作将删除所有邮箱数据，且无法恢复。是否确认删除？',function(){
localStorage.removeItem('emailData');
loadData();
showModal('删除成功','所有邮箱数据已全部删除！');
});
}
function renderPagination(totalItems){
const pagination=document.getElementById('pagination');
pagination.innerHTML='';
const totalPages=Math.ceil(totalItems/itemsPerPage);
const maxButtons=5;
let startPage=Math.max(1,currentPage-Math.floor(maxButtons/2));
let endPage=Math.min(totalPages,startPage+maxButtons-1);
if(endPage-startPage+1<maxButtons){startPage=Math.max(1,endPage-maxButtons+1);}
if(currentPage>1){
const prevButton=document.createElement('button');
prevButton.textContent='上一页';
prevButton.onclick=()=>changePage(currentPage-1);
pagination.appendChild(prevButton);
}
if(startPage>1){
const firstButton=document.createElement('button');
firstButton.textContent='1';
firstButton.onclick=()=>changePage(1);
pagination.appendChild(firstButton);
if(startPage>2){const ellipsis=document.createElement('span');ellipsis.textContent='...';pagination.appendChild(ellipsis);}
}
for(let i=startPage;i<=endPage;i++){
const button=document.createElement('button');
button.textContent=i;
if(i===currentPage){button.classList.add('active');}
button.onclick=()=>changePage(i);
pagination.appendChild(button);
}
if(endPage<totalPages){
if(endPage<totalPages-1){const ellipsis=document.createElement('span');ellipsis.textContent='...';pagination.appendChild(ellipsis);}
const lastButton=document.createElement('button');
lastButton.textContent=totalPages;
lastButton.onclick=()=>changePage(totalPages);
pagination.appendChild(lastButton);
}
if(currentPage<totalPages){
const nextButton=document.createElement('button');
nextButton.textContent='下一页';
nextButton.onclick=()=>changePage(currentPage+1);
pagination.appendChild(nextButton);
}
}
function changePage(page){
currentPage=page;
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
renderTable(filteredData);
renderPagination(filteredData.length);
}
function changeItemsPerPage(value){
itemsPerPage=parseInt(value,10);
currentPage=1;
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
renderTable(filteredData);
renderPagination(filteredData.length);
}
function toggleNoData(isEmpty){
const noData=document.getElementById('no-data');
noData.style.display=isEmpty?'block':'none';
}
function viewInbox(index){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
const item=filteredData[index];
currentMailPage=1;
mailSearchKeyword='';
document.getElementById('mail-search').value='';
loadMailList(item.refreshToken,item.clientId,item.email,'INBOX');
}
function viewJunk(index){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
const item=filteredData[index];
currentMailPage=1;
mailSearchKeyword='';
document.getElementById('mail-search').value='';
loadMailList(item.refreshToken,item.clientId,item.email,'Junk');
}
function loadMailList(refreshToken,clientId,email,mailbox){
showLoading();
const encryptedPassword=localStorage.getItem('password')||'';
let password='';
if(encryptedPassword){const decryptedPwd=decryptData(encryptedPassword);password=decryptedPwd||'';}
const apiUrl=`/api/mail-all?refresh_token=${refreshToken}&client_id=${clientId}&email=${email}&mailbox=${mailbox}&response_type=json&password=${password}`;
fetch(apiUrl).then(response=>{
if(!response.ok){
if(response.status===500){
return response.json().then(errorData=>{
if(errorData.error==="Nothing to fetch"){
mailData=[];
originalMailData=[];
document.querySelectorAll('.content-section').forEach(section=>section.classList.remove('active'));
document.getElementById('mail-list').classList.add('active');
renderMailTable(mailData);
return Promise.resolve();
}else{throw new Error('服务器内部错误，请稍后重试。');}
});
}else{
if(response.status===401){throw response;}
throw new Error(`请求失败，状态码：${response.status}`);
}
}
return response.json();
}).then(data=>{
if(data){
mailData=data;
originalMailData=[...data];
document.querySelectorAll('.content-section').forEach(section=>section.classList.remove('active'));
document.getElementById('mail-list').classList.add('active');
renderMailTable(mailData);
}
}).catch(error=>{
if(error.status===401){
showModal('提示','为了防止滥用，已加密码验证。如需使用请购买，请联系管理员小黑QQ：113575320。');
return;
}
if(error.message.includes('服务器内部错误')){showModal('错误','服务器内部错误，请稍后重试。');}
else{showModal('错误','无法加载邮件数据，请检查网络连接或稍后重试。');}
}).finally(()=>{hideLoading();});
}
function renderMailTable(data){
const mailTableBody=document.querySelector('#mail-table tbody');
mailTableBody.innerHTML='';
if(data.length===0){document.getElementById('no-data-mail').style.display='block';}
else{document.getElementById('no-data-mail').style.display='none';}
const start=(currentMailPage-1)*mailItemsPerPage;
const end=start+mailItemsPerPage;
const pageData=data.slice(start,end);
pageData.forEach((item,index)=>{
const row=document.createElement('tr');
row.innerHTML=`
<td>${item.send}</td>
<td>${item.subject}</td>
<td>${item.date}</td>
<td class="actions">
<button onclick="viewMail(${start + index})">查看</button>
</td>
`;
mailTableBody.appendChild(row);
});
renderMailPagination(data.length);
}
function renderMailPagination(totalItems){
const pagination=document.getElementById('pagination-mail');
pagination.innerHTML='';
const totalPages=Math.ceil(totalItems/mailItemsPerPage);
for(let i=1;i<=totalPages;i++){
const button=document.createElement('button');
button.textContent=i;
if(i===currentMailPage){button.classList.add('active');}
button.onclick=()=>changeMailPage(i);
pagination.appendChild(button);
}
}
function changeMailPage(page){
currentMailPage=page;
const renderData=mailSearchKeyword?originalMailData.filter(item=>item.send.toLowerCase().includes(mailSearchKeyword)||item.subject.toLowerCase().includes(mailSearchKeyword)):originalMailData;
renderMailTable(renderData);
}
function searchMails(){
mailSearchKeyword=document.getElementById('mail-search').value.trim().toLowerCase();
currentMailPage=1;
const filteredData=originalMailData.filter(item=>item.send.toLowerCase().includes(mailSearchKeyword)||item.subject.toLowerCase().includes(mailSearchKeyword));
renderMailTable(filteredData);
}
function clearMailSearch(){
document.getElementById('mail-search').value='';
mailSearchKeyword='';
currentMailPage=1;
renderMailTable(originalMailData);
}
function viewMail(index){
const targetData=mailSearchKeyword?originalMailData.filter(item=>item.send.toLowerCase().includes(mailSearchKeyword)||item.subject.toLowerCase().includes(mailSearchKeyword))[index]:originalMailData[index];
if(targetData){
document.getElementById('mail-modal-title').textContent=targetData.subject;
document.getElementById('mail-modal-sender').textContent=`发件人: ${targetData.send}`;
document.getElementById('mail-modal-subject').textContent=`主题: ${targetData.subject}`;
document.getElementById('mail-modal-date').textContent=`日期: ${targetData.date}`;
document.getElementById('mail-modal-content').innerHTML=`内容: ${targetData.html || targetData.text}`;
document.getElementById('mail-modal').style.display='flex';
}else{console.error('邮件数据不存在:',index);}
}
function closeMailModal(){document.getElementById('mail-modal').style.display='none';}
function showDeleteConfirm(index){
confirmCallback=function(){deleteEmail(index);};
document.getElementById('confirm-title').textContent='确认删除';
document.getElementById('confirm-message').textContent='确定要删除该邮箱吗？删除后不可恢复';
document.getElementById('confirm-modal').style.display='flex';
}
function deleteEmail(index){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
const originalIndex=data.findIndex(item=>item.email===filteredData[index].email);
if(originalIndex!==-1){
const deletedEmail=data[originalIndex].email;
data.splice(originalIndex,1);
localStorage.setItem('emailData',encryptData(data));
loadData();
showModal('删除成功',`邮箱 ${deletedEmail} 已成功删除`);
}
}
function importEmails(){
const delimiter=document.getElementById('delimiter').value.trim();
const fileInput=document.getElementById('file-input');
if(!delimiter){showModal('错误','请输入分隔符！');return;}
if(fileInput.files.length===0){showModal('错误','请选择文件！');return;}
const file=fileInput.files[0];
const reader=new FileReader();
reader.onload=function(e){
showLoading();
const content=e.target.result;
const lines=content.split('\n').filter(line=>line.trim()!=='');
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const existingEmails=new Set(data.map(item=>item.email.toLowerCase()));
let successCount=0;
let duplicateCount=0;
let errorCount=0;
lines.forEach(line=>{
const fields=line.split(delimiter).map(field=>field.trim());
if(fields.length>=4){
const email=fields[0].trim();
const password=fields[1].trim();
const clientId=fields[2].trim();
const refreshToken=fields[3].trim();
if(email&&password&&clientId&&refreshToken){
if(existingEmails.has(email.toLowerCase())){duplicateCount++;return;}
data.push({email,password,clientId,refreshToken});
existingEmails.add(email.toLowerCase());
successCount++;
}else{errorCount++;}
}else{errorCount++;}
});
localStorage.setItem('emailData',encryptData(data));
loadData();
hideLoading();
showModal('导入完成',`成功导入：${successCount} 条<br>重复跳过：${duplicateCount} 条<br>格式错误：${errorCount} 条`);
fileInput.value='';
document.getElementById('file-info').textContent='';
};
reader.readAsText(file);
}
function initDragUpload(){
const uploadBox=document.getElementById('upload-box');
const fileInput=document.getElementById('file-input');
const fileInfo=document.getElementById('file-info');
uploadBox.addEventListener('click',()=>{fileInput.click();});
fileInput.addEventListener('change',()=>{if(fileInput.files.length>0){fileInfo.textContent=`已选择文件：${fileInput.files[0].name}`;}});
uploadBox.addEventListener('dragover',(e)=>{e.preventDefault();uploadBox.classList.add('dragover');});
uploadBox.addEventListener('dragleave',()=>{uploadBox.classList.remove('dragover');});
uploadBox.addEventListener('drop',(e)=>{
e.preventDefault();
uploadBox.classList.remove('dragover');
const files=e.dataTransfer.files;
if(files.length>0){fileInput.files=files;fileInfo.textContent=`已选择文件：${files[0].name}`;}
});
}
const modal=document.getElementById('modal');
const confirmModal=document.getElementById('confirm-modal');
const editModal=document.getElementById('edit-modal');
function showModal(title,message){
document.getElementById('modal-title').textContent=title;
document.getElementById('modal-message').innerHTML=message;
modal.style.display='flex';
}
function showConfirmModal(title,message,callback){
confirmCallback=callback;
document.getElementById('confirm-title').textContent=title;
document.getElementById('confirm-message').textContent=message;
confirmModal.style.display='flex';
}
function confirmAction(){
if(typeof confirmCallback==='function'){confirmCallback();}
closeConfirmModal();
}
function closeModal(){modal.style.display='none';}
function closeConfirmModal(){
confirmModal.style.display='none';
confirmCallback=null;
}
function editEmail(index){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const filteredData=searchKeyword?data.filter(item=>item.email.toLowerCase().includes(searchKeyword)):data;
const item=filteredData[index];
if(item){
document.getElementById('edit-email-original').value=item.email;
document.getElementById('edit-email').value=item.email;
document.getElementById('edit-password').value=item.password;
document.getElementById('edit-client-id').value=item.clientId;
document.getElementById('edit-refresh-token').value=item.refreshToken;
editModal.style.display='flex';
}
}
function closeEditModal(){editModal.style.display='none';}
function saveEdit(){
const originalEmail=document.getElementById('edit-email-original').value.trim();
const password=document.getElementById('edit-password').value.trim();
const clientId=document.getElementById('edit-client-id').value.trim();
const refreshToken=document.getElementById('edit-refresh-token').value.trim();
if(!password||!clientId||!refreshToken){showModal('错误','密码、Client ID、Refresh Token 不能为空！');return;}
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const index=data.findIndex(item=>item.email===originalEmail);
if(index!==-1){
data[index].password=password;
data[index].clientId=clientId;
data[index].refreshToken=refreshToken;
localStorage.setItem('emailData',encryptData(data));
loadData();
closeEditModal();
showModal('编辑成功',`邮箱 ${originalEmail} 信息已更新`);
}else{showModal('错误','未找到该邮箱数据！');}
}
function exportData(){
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
if(data.length===0){showModal('提示','当前没有邮箱数据可导出！');return;}
const txtContent=data.map(item=>`${item.email}----${item.password}----${item.clientId}----${item.refreshToken}`).join('\n');
const blob=new Blob([txtContent],{type:'text/plain'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`邮箱数据备份_${new Date().toLocaleDateString().replace(/\//g,'-')}.txt`;
document.body.appendChild(a);
a.click();
document.body.removeChild(a);
URL.revokeObjectURL(url);
showModal('导出成功','数据已导出为TXT文件（格式：邮箱----密码----Client ID----Refresh Token）');
}
function toggleAllPasswords(){
passwordVisible=!passwordVisible;
const passwordTexts=document.querySelectorAll('.password-text');
const toggleBtns=document.querySelectorAll('.password-toggle:not(.edit-modal-content .password-toggle)');
passwordTexts.forEach((span,index)=>{
const row=span.closest('tr');
const email=row.cells[1].textContent;
const encryptedData=localStorage.getItem('emailData')||'';
let data=encryptedData?decryptData(encryptedData)||[]:[];
const item=data.find(item=>item.email===email);
if(item){span.textContent=passwordVisible?item.password:'••••••••';}
toggleBtns[index].innerHTML=passwordVisible?'<i class="fas fa-eye-slash"></i>':'<i class="fas fa-eye"></i>';
});
const headerBtn=document.querySelector('th .password-toggle i');
headerBtn.className=passwordVisible?'fas fa-eye-slash':'fas fa-eye';
}
function animateValue(id,start,end,duration){
let startTimestamp=null;
const element=document.getElementById(id);
const step=(timestamp)=>{
if(!startTimestamp)startTimestamp=timestamp;
const progress=Math.min((timestamp-startTimestamp)/duration,1);
const value=Math.floor(progress*(end-start)+start);
element.textContent=value;
if(progress<1){window.requestAnimationFrame(step);}
};
window.requestAnimationFrame(step);
}
function updateDashboard(data){
const countElement=document.getElementById('account-count');
const currentValue=parseInt(countElement.textContent)||0;
const targetValue=data.length;
if(currentValue!==targetValue){animateValue('account-count',currentValue,targetValue,1000);}
}
function searchEmails(){
searchKeyword=document.getElementById('email-search').value.trim().toLowerCase();
currentPage=1;
loadData();
}
function clearSearch(){
document.getElementById('email-search').value='';
searchKeyword='';
currentPage=1;
loadData();
}
function setPassword(){
const password=document.getElementById('password').value;
if(password){localStorage.setItem('password',encryptData(password));}
else{localStorage.removeItem('password');}
}
function initSearchEnter(){
document.getElementById('email-search').addEventListener('keypress',function(e){if(e.key==='Enter'){searchEmails();}});
document.getElementById('mail-search').addEventListener('keypress',function(e){if(e.key==='Enter'){searchMails();}});
}
function initWindowResize(){
window.addEventListener('resize',function(){if(window.innerWidth>768){document.getElementById('sidebar').classList.remove('active');}});
}
function initDevInfo(){console.log('小黑邮箱管理系统 - 开发者QQ:113575320');}
</script>
</body>
</html>
